<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欢迎使用</title>
    <link rel="stylesheet" type="text/css" href="static/css/step.css"/>
    <link rel="stylesheet" type="text/css" href="static/css/base.css"/>
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css"/>
    <script src="static/js/jquery-1.11.0.min.js"></script>
    <script src="static/js/bootstrap.js"></script>
    <script src="static/js/main.js"></script>
    <script>
        var config = null;
        var preBtn = null;
        var hintDiv = null;
        var repeatDiv = null;
        var repeatBtn = null;
        var downloadBtn = null;
        function checkChange(){return true;}

        function repeatFunc(){
            removeClass(hintDiv, 'hidden');
            removeClass(repeatDiv, 'hidden');
        }

        function initData(){
            preBtn = document.getElementById('preBtn');
            hintDiv = document.getElementById('hintDiv');
            repeatDiv = document.getElementById('repeatDiv');
            repeatBtn = document.getElementById('repeatBtn');
            saveProBtn = document.getElementById('saveProBtn');
            downloadBtn = document.getElementById("downloadBtn");
            saveProBtn.nwsaveas = config.title +".zip";

            saveProBtn.addEventListener('change', function(evt){
                var files = this.files;
                var filesPath = files[0].path;
                downloadproblem(filesPath, function success(){
                    removeClass(message, "alert-danger");
                    addClass(message, "alert-success");
                    message.innerHTML = "保存成功！";
                    removeClass(message, "hidden");
                    repeatFunc();
                }, function error(err){
                    removeClass(message, "alert-success");
                    addClass(message, "alert-danger");
                    message.innerHTML = "校验失败, 请仔细检查一下项目！<br/>" + err;
                    removeClass(message, "hidden");
                });
             });

            repeatBtn.onclick = function(){
                deleteAllFiles(PROBLEM_ROOT_PATH);
                window.location.href = "step1.html";
            }

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });
        }
        window.onload=function(){
            initStep();
            getConfig(function success(data){
                config = data;
                initData();
            }, function error(err){
                alert(err);
            });
        }
    </script>
</head>
<body>
<div class = "body-container container">
    <div class="row">
        <div class="navbar-wrapper maintitle" role="navigation">
            <h1>南京理工大学程序设计能力评测系统题目打包程序</h1>
        </div>
        <div class="six steps large step-navbar">
            <span name = "stepBtn" class="step">开始</span>
            <span name = "stepBtn" class="step">题目基本信息</span>
            <span name = "stepBtn" class="step">编辑题目内容</span>
            <span name = "stepBtn" class="step">添加测试用例</span>
            <span name = "stepBtn" class="step">添加题解</span>
            <span name = "stepBtn" class="step active">确认</span>
        </div>
        <div class="col-md-8 col-md-offset-2">
            <h2 class="center-block text-center">完成</h2>
            <div id = "message" class="alert alert-dismissable hidden">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                    &times;
                </button>
            </div>
            <br/>
            <ul class="h4">
                <li>如果您已填写了之前的所有项目并且确定填写正确, 您可以单击下方的下载题目信息按钮来下载题目压缩包</li>
                <br/>
                <li>当然, 在您单击按钮之后, 我们会对您之前的工作做一个校验, 但是类似题目内容和参考题解这类的信息, 我们无法校验, 还请您注意检查</li>
                <br/>
                <li>当您的测试文件数据量很大时生成压缩包的时间会比较长, 请您耐心等待</li>
            </ul>
            <div id = "hintDiv" class="alert alert-dismissable alert-warning hidden">
                <strong>提醒 </strong>您可以单击重新开始一道新的题目按钮来编辑一道新的题目, 但是这会导致您当前的编辑信息丢失, 请您在确定已经成功下载题目信息压缩包后再继续.
            </div>
            <div class="text-center">
                <div class="btn-group">
                    <span class="btn btn-default downloadBtn" id="downloadBtn" data-toggle="tooltip" data-placement="bottom" title="下载题目信息">
                        <span class="glyphicon glyphicon-download-alt downloadico" aria-hidden="true"></span>
                        <input type='file' nwsaveas='problem.zip' id="saveProBtn"/>
                    </span>
                </div>
                <div class="btn-group hidden" id="repeatDiv">
                    <button class="btn btn-default " id="repeatBtn" data-toggle="tooltip" data-placement="bottom" title="重新开始一道新的题目"><span class="glyphicon glyphicon-repeat downloadico" aria-hidden="true"></span></button>
                </div>
            </div>
            <br/>
        </div>
    </div>
    <div class="preStepBtn">
        <a class="btn btn-success" href="step4.html" role="button" id="preBtn"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true">上一步</span></a>
    </div>
</div>
<div class="footer">
    <img class="pull-right" width="64px" height="64px" src="static/images/ICPC-Logo-Fishead.png">
    <div class="footer-text">
        <small class="pull-right">南京理工大学程序设计能力评测系统题目打包程序</small><br>
        <p class="footer-p">
            <small class="pull-right">版权所有 &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, 南京理工大学FishTeam开发组，保留一切权利</small>
        </p>
    </div>
</div>
</body>
</html>
